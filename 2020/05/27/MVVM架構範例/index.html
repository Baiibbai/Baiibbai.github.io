<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>MVVM架構範例 | Baiibbai的部落格</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="介紹 分成 Model,ViewModel,View  Model : 邏輯 ViewModel : 控制View連結Activity&#x2F;Fragment View : 在Activity&#x2F;Fragment裡，只保留單純的View    範例 EventsFragment發Request將資料更新到RecyclerView 向下拉更新資料 點擊Item開啟新頁面">
<meta property="og:type" content="article">
<meta property="og:title" content="MVVM架構範例">
<meta property="og:url" content="https://baiibbai.github.io/2020/05/27/MVVM%E6%9E%B6%E6%A7%8B%E7%AF%84%E4%BE%8B/index.html">
<meta property="og:site_name" content="Baiibbai的部落格">
<meta property="og:description" content="介紹 分成 Model,ViewModel,View  Model : 邏輯 ViewModel : 控制View連結Activity&#x2F;Fragment View : 在Activity&#x2F;Fragment裡，只保留單純的View    範例 EventsFragment發Request將資料更新到RecyclerView 向下拉更新資料 點擊Item開啟新頁面">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2020-05-27T05:51:05.000Z">
<meta property="article:modified_time" content="2020-05-27T08:25:53.920Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="MVVM">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Baiibbai的部落格" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Baiibbai的部落格</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">MVVM架構範例</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜尋"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://baiibbai.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-MVVM架構範例" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/27/MVVM%E6%9E%B6%E6%A7%8B%E7%AF%84%E4%BE%8B/" class="article-date">
  <time datetime="2020-05-27T05:51:05.000Z" itemprop="datePublished">2020-05-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      MVVM架構範例
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="介紹"><a href="#介紹" class="headerlink" title="介紹"></a>介紹</h2><ul>
<li><p>分成 Model,ViewModel,View</p>
<ol>
<li>Model : 邏輯</li>
<li>ViewModel : 控制View連結Activity/Fragment</li>
<li>View : 在Activity/Fragment裡，只保留單純的View</li>
</ol>
</li>
</ul>
<h2 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h2><ul>
<li>EventsFragment發Request將資料更新到RecyclerView</li>
<li>向下拉更新資料</li>
<li>點擊Item開啟新頁面</li>
</ul>
<a id="more"></a>


<h1 id="DataBinding"><a href="#DataBinding" class="headerlink" title="DataBinding"></a>DataBinding</h1><ul>
<li>build.gradle(app)<ul>
<li>Data Binding 將View跟ViewModel綁定</li>
<li>可在ViewModel做資料更改 直接設定給View</li>
<li>在build.gradle(app)啟用dataBinding</li>
</ul>
</li>
</ul>
<pre><code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">android&#123;</span><br><span class="line">   		comileSdkVersion <span class="number">29</span></span><br><span class="line">   		buildToolsVersion <span class="string">"29.0.0"</span></span><br><span class="line">           </span><br><span class="line">   		<span class="comment">//啟用 Data Binding</span></span><br><span class="line">     		dataBinding&#123;</span><br><span class="line">       		enabled = <span class="keyword">true</span>;</span><br><span class="line">   		&#125;</span><br><span class="line">   		...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><p>在原本的 fragment_events.xml 的最外層加上 (在 Root View 按 Alt + Enter -&gt; Convert to data binding layout)，並在 裡面宣告要跟 View 綁定的 ViewModel</p>
<h2 id="fragment-events-xml"><a href="#fragment-events-xml" class="headerlink" title="fragment_events.xml"></a>fragment_events.xml</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">"android.view.View"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"viewModel"</span> <span class="attr">type</span>=<span class="string">"com.example.mvvmtest2.EventsViewModel"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">  	<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="EventsFragment-java"><a href="#EventsFragment-java" class="headerlink" title="EventsFragment.java"></a>EventsFragment.java</h2><ul>
<li><p>宣告Binding與EventsViewModel.java</p>
</li>
<li><p>對View進行Binding 即會自動生成 FragmentEventsBinding此名稱</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Events DataBinding</span></span><br><span class="line"><span class="keyword">private</span> FragmentEventsBinding mBinding;</span><br><span class="line"><span class="keyword">private</span> EventsViewModel mViewModel;</span><br></pre></td></tr></table></figure>
</li>
<li><p>設定EventsFragment的View</p>
</li>
<li><p>綁定ViewModel</p>
</li>
<li><p>使用setLifecycleOwner需要在 gradle.app引入</p>
<ul>
<li><p>implementation ‘androidx.lifecycle:lifecycle-extensions:2.1.0’</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="comment">//綁定Layout</span></span><br><span class="line">		mBinding = DataBindingUtil.inflate(inflater, R.layout.fragment_events, container, <span class="keyword">false</span>);</span><br><span class="line">		View v = mBinding.getRoot();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//設定ViewModel與Layout的綁定</span></span><br><span class="line">		mViewModel = <span class="keyword">new</span> EventsViewModel();</span><br><span class="line">		mBinding.setViewModel(mViewModel);</span><br><span class="line">		<span class="comment">//解決手機旋轉問題</span></span><br><span class="line">		mBinding.setLifecycleOwner(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>不需再宣告元件做綁定，直接使用mBinding找到元件</p>
</li>
<li><p>以下是綁定更改過後EventsFragment.java 的 OnCreate()</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventsFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> FragmentEventsBinding mBinding;</span><br><span class="line">	<span class="keyword">private</span> EventsViewModel mViewModel;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//設定RecyclerView.Adapter</span></span><br><span class="line">	<span class="comment">//private RecyclerView.Adapter mRecyclerAdapter;</span></span><br><span class="line">	<span class="keyword">private</span> EventsAdapter mRecyclerAdapter;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//此頁面</span></span><br><span class="line">	<span class="keyword">private</span> Fragment mEventsFragment = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		mBinding = DataBindingUtil.inflate(inflater, R.layout.fragment_events, container, <span class="keyword">false</span>);</span><br><span class="line">		View v = mBinding.getRoot();</span><br><span class="line"></span><br><span class="line">		mViewModel = <span class="keyword">new</span> EventsViewModel();</span><br><span class="line">		mBinding.setViewModel(mViewModel);</span><br><span class="line">		mBinding.setLifecycleOwner(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//設定顏色</span></span><br><span class="line">		mBinding.eventsLayswipeUpdateUpdate</span><br><span class="line">				.setColorSchemeResources(android.R.color.holo_red_light, android.R.color.holo_blue_light,</span><br><span class="line">				                         android.R.color.holo_green_light, android.R.color.holo_orange_light);</span><br><span class="line">		<span class="comment">//其餘設定...</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> view;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="重構EventsFragment-java"><a href="#重構EventsFragment-java" class="headerlink" title="重構EventsFragment.java"></a>重構EventsFragment.java</h1><h2 id="EventsFragment-java-1"><a href="#EventsFragment-java-1" class="headerlink" title="EventsFragment.java"></a>EventsFragment.java</h2><ul>
<li><p>將EventsFragment.java 分割出 ViewModel(View資料直接設定)Model(邏輯)</p>
</li>
<li><p>原先寫在EventsFragemt.java的 request請求邏輯放到Model</p>
</li>
<li><p>將與此方法有關的邏輯都分割到Model</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//請求request</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getStoreMessage</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    EventsRequest request = <span class="keyword">new</span> EventsRequest(mEventsListener);</span><br><span class="line">    request.send();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="EventsModel-java"><a href="#EventsModel-java" class="headerlink" title="EventsModel.java"></a>EventsModel.java</h2><ul>
<li><p>新增EventsModel.java</p>
</li>
<li><p>將發出request的邏輯搬到這裡</p>
</li>
<li><p>並設定接口，可將資料傳出</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventsModel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="comment">//Events資料抓取指向</span></span><br><span class="line">	<span class="keyword">private</span> itemEvents mResponse;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//設定傳送接口</span></span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">itemEvents</span></span></span><br><span class="line"><span class="class">	</span>&#123;</span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(List&lt;EventsApi.ListApi&gt; data)</span></span>;</span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">onError</span><span class="params">(String errorResulte)</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//抓取EventsList接口</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">sendMsgResponse</span><span class="params">(<span class="keyword">final</span> itemEvents response)</span></span>&#123;</span><br><span class="line">		mResponse = response;</span><br><span class="line">		EventsRequest request = <span class="keyword">new</span> EventsRequest(mEventsListener);</span><br><span class="line">		request.send();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> EventsRequest.EventsListener mEventsListener = <span class="keyword">new</span> EventsRequest.EventsListener()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(List&lt;EventsApi.ListEvents&gt; result)</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			mResponse.onSuccess(result);</span><br><span class="line">			Log.i(<span class="string">"EventsModel"</span>, <span class="string">"success"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(String errorResulte)</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			mResponse.onError(errorResulte);</span><br><span class="line">			Log.i(<span class="string">"EventsModel"</span>, <span class="string">"error"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="EventsViewModel-java"><a href="#EventsViewModel-java" class="headerlink" title="EventsViewModel.java"></a>EventsViewModel.java</h2><ul>
<li><p>新增EventsViewModel.java</p>
</li>
<li><p>將model抓到的request結果，利用接口在EventsViewModel.java上使用，設定給List</p>
</li>
<li><p>新增MutableLiveData<Boolean>變數，如果資料請求成功，將Boolean設定成true</p>
<ul>
<li>MutableLiveData&lt;&gt; 可設定Observe 如資料變動 即可呼叫監聽器執行動作</li>
<li>使用方法:要將資料設定進去 使用postvalue()</li>
</ul>
</li>
<li><p>在EventsFragment.java設定監聽此變數判斷是否抓取List成功</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventsViewModel</span> <span class="keyword">extends</span> <span class="title">ViewModel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="comment">//List</span></span><br><span class="line">	List&lt;EventsApi.ListEvents&gt; mEventsList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">	<span class="comment">//model</span></span><br><span class="line">	<span class="keyword">private</span> EventsModel mModel = <span class="keyword">new</span> EventsModel();</span><br><span class="line">	<span class="comment">//是否抓取到資料</span></span><br><span class="line">	MutableLiveData&lt;Boolean&gt; mIsEventsDataGet = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//抓取EventsList Request</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">getEventsList</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		mModel.sendMsgResponse(<span class="keyword">new</span> EventsModel.itemEvents()</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(List&lt;EventsApi.ListEvents&gt; data)</span></span></span><br><span class="line"><span class="function">			</span>&#123;</span><br><span class="line">				<span class="comment">//資料抓取成功</span></span><br><span class="line">				mIsEventsDataGet.postValue(<span class="keyword">true</span>);</span><br><span class="line">				<span class="comment">//將資料放入List</span></span><br><span class="line">				mEventsList = data;</span><br><span class="line">				</span><br><span class="line">				Log.i(<span class="string">"EventsViewModel"</span>, <span class="string">"getEventsList:onSuccess"</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(String errorResulte)</span></span></span><br><span class="line"><span class="function">			</span>&#123;</span><br><span class="line">				<span class="comment">//資料抓取失敗</span></span><br><span class="line">				mIsEventsDataGet.postValue(<span class="keyword">false</span>);</span><br><span class="line">				Log.i(<span class="string">"EventsViewModel"</span>, <span class="string">"getEventsList:onError"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在onCreate()裡呼叫ViewModel的request請求(getEventsList())</p>
</li>
<li><p>並監聽MutableLiveData<Boolean> mIsEventsDataGet是否成功抓取List，並設定Adapter</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">      mViewModel.getEventsList();</span><br><span class="line">mViewModel.mIsEventsDataGet.observe(<span class="keyword">this</span>, <span class="keyword">new</span> Observer&lt;Boolean&gt;()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">(Boolean aBoolean)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( aBoolean )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//mData = mViewModel.mEventsList;</span></span><br><span class="line">			setRecyclerView();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">mViewModel.mEventsList.observe(<span class="keyword">this</span>, <span class="keyword">new</span> Observer&lt;List&lt;EventsInfo&gt;&gt;()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">(List&lt;EventsInfo&gt; listEvents)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span></span><br><span class="line">		&#123;</span><br><span class="line">			Log.i(<span class="string">"EventsFragment"</span>, <span class="string">"eventsList:observe"</span>);</span><br><span class="line">			mRecyclerAdapter.refresh(listEvents);</span><br><span class="line">			mRecyclerAdapter.notifyDataSetChanged();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span>( Exception e )</span><br><span class="line">		&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//當動作被執行</span></span><br><span class="line">mBinding.eventsLayswipeUpdateUpdate.setOnRefreshListener(<span class="keyword">new</span> SwipeRefreshLayout.OnRefreshListener()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//取得店家資訊</span></span><br><span class="line">		mViewModel.getEventsList();</span><br><span class="line">		mRecyclerAdapter.notifyDataSetChanged();</span><br><span class="line">		mBinding.eventsLayswipeUpdateUpdate.setRefreshing(<span class="keyword">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="改寫Adapter"><a href="#改寫Adapter" class="headerlink" title="改寫Adapter"></a>改寫Adapter</h1><h2 id="新增Comparable-java-interface"><a href="#新增Comparable-java-interface" class="headerlink" title="新增Comparable.java(interface)"></a>新增Comparable.java(interface)</h2><ul>
<li><p>可對資料做比對，用於更新機制</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Comparable</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Compable</span>&lt;<span class="title">T</span>&gt;&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">areItemsTheSame</span><span class="params">(T t)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">areContentsTheSame</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="新增資料EventsInfo-java"><a href="#新增資料EventsInfo-java" class="headerlink" title="新增資料EventsInfo.java"></a>新增資料EventsInfo.java</h2><ul>
<li><p>使資料可以做比對、更新</p>
</li>
<li><p>將原本的EventsApi.ListEvents裡儲存的資料型態都放進去</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventsInfo</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">EventsInfo</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> String title, beginData, endData,iconUrl,url;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">areItemsTheSame</span><span class="params">(EventsInfo eventsInfo)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.title.equals(eventsInfo.title);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">areContentsTheSame</span><span class="params">(EventsInfo eventsInfo)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">this</span>.iconUrl.equals(eventsInfo.iconUrl))&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">this</span>.url.equals(eventsInfo.url))&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!<span class="keyword">this</span>.beginData.equals(eventsInfo.beginData))&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.endData.equals(eventsInfo.endData);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="layout-events-recyclerview-xml"><a href="#layout-events-recyclerview-xml" class="headerlink" title="layout_events_recyclerview.xml"></a>layout_events_recyclerview.xml</h2><ul>
<li>對layout_events_recyclerview.xml做DataBinding</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"item"</span> <span class="attr">type</span>=<span class="string">"com.example.mvvmtest2.EventsInfo"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="EventsAdapter-java"><a href="#EventsAdapter-java" class="headerlink" title="EventsAdapter.java"></a>EventsAdapter.java</h2><ul>
<li>使此Adapter可以共用</li>
<li>點擊傳出點擊位置</li>
<li>有更新機制</li>
<li>可以用DataBinding</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventsAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">EventsAdapter</span>.<span class="title">ViewHolder</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="comment">//儲存資料</span></span><br><span class="line">   <span class="comment">//public List&lt;EventsApi.ListEvents&gt; mData;</span></span><br><span class="line"><span class="comment">//宣告可比對資料的 List</span></span><br><span class="line"><span class="keyword">private</span> List&lt;? extends Comparable&gt; mItemList;</span><br><span class="line"><span class="comment">//RecyclerView的Layout</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mLayoutRes;</span><br><span class="line"></span><br><span class="line"><span class="comment">//清單按鈕</span></span><br><span class="line"><span class="keyword">private</span> OnClickListener mListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">//按鈕事件</span></span><br><span class="line"><span class="comment">//改為傳送點擊位置 將邏輯拋回fragment</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnClickListener</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">//因為使用DataBinding 所以不用額外宣告元件</span></span><br><span class="line">    <span class="comment">//商店名稱</span></span><br><span class="line">	<span class="comment">//TextView mTvStoreName;</span></span><br><span class="line">	<span class="comment">//開始時間</span></span><br><span class="line">	<span class="comment">//TextView mTvBeginTime;</span></span><br><span class="line">	<span class="comment">//結束時間</span></span><br><span class="line">	<span class="comment">//TextView mTvEndTime;</span></span><br><span class="line">	<span class="comment">//商店圖片</span></span><br><span class="line">	<span class="comment">//ImageView mIvStorePic;</span></span><br><span class="line">			</span><br><span class="line">	<span class="keyword">private</span> ViewDataBinding mItemBinding;</span><br><span class="line"></span><br><span class="line">	ViewHolder(ViewDataBinding binding)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">super</span>(binding.getRoot());</span><br><span class="line">		mItemBinding = binding;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">bind</span><span class="params">(Comparable item)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		mItemBinding.setVariable(BR.item, item);</span><br><span class="line">		mItemBinding.executePendingBindings();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//資料連結</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">EventsAdapter</span><span class="params">(List&lt;? extends Comparable&gt; itemList, <span class="keyword">int</span> layoutRes, OnClickListener listener)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//Adapter輸入資料更改</span></span><br><span class="line">	mItemList = itemList;</span><br><span class="line">	mLayoutRes = layoutRes;</span><br><span class="line">	mListener = listener;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(@NonNull ViewGroup parent, <span class="keyword">int</span> viewType)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//這邊更改為用Binding的方法 塞入Layout</span></span><br><span class="line">	LayoutInflater layoutInflater = LayoutInflater.from(parent.getContext());</span><br><span class="line">	ViewDataBinding itemBinding = DataBindingUtil.inflate(layoutInflater, mLayoutRes, parent, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> ViewHolder(itemBinding);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(@NonNull <span class="keyword">final</span> ViewHolder holder, <span class="keyword">final</span> <span class="keyword">int</span> position)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//加載圖片在layout另外做設定 也不需要綁訂元件</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//將Adapter與List綁定</span></span><br><span class="line">	Comparable item = mItemList.get(position);</span><br><span class="line">	holder.bind(item);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//點擊事件抓取position</span></span><br><span class="line">	holder.itemView.setOnClickListener(<span class="keyword">new</span> View.OnClickListener()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			mListener.onClick(position);</span><br><span class="line">			Log.i(<span class="string">"CommonAdapter"</span>, <span class="string">"position:"</span> + position);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//清單長度</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> mItemList.size();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//在此新增更新功能</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">(List&lt;? extends Comparable&gt; itemList)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	DiffUtil.DiffResult diffResult = DiffUtil.calculateDiff(<span class="keyword">new</span> ItemDiffCallBack(mItemList, itemList), <span class="keyword">true</span>);</span><br><span class="line">	diffResult.dispatchUpdatesTo(<span class="keyword">this</span>);</span><br><span class="line">	mItemList = itemList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//使新舊資料做比較 更新</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemDiffCallBack</span> <span class="keyword">extends</span> <span class="title">DiffUtil</span>.<span class="title">Callback</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;? extends Comparable&gt; mOldItemList;</span><br><span class="line">	<span class="keyword">private</span> List&lt;? extends Comparable&gt; mNewItemList;</span><br><span class="line"></span><br><span class="line">	ItemDiffCallBack(List&lt;? extends Comparable&gt; oldItemList, List&lt;? extends Comparable&gt; newItemList)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">this</span>.mOldItemList = oldItemList;</span><br><span class="line">		<span class="keyword">this</span>.mNewItemList = newItemList;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOldListSize</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mOldItemList != <span class="keyword">null</span> ? mOldItemList.size() : <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNewListSize</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mNewItemList != <span class="keyword">null</span> ? mNewItemList.size() : <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">areItemsTheSame</span><span class="params">(<span class="keyword">int</span> oldItemPosition, <span class="keyword">int</span> newItemPosition)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mOldItemList.get(oldItemPosition).areItemsTheSame(mNewItemList.get(newItemPosition));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">areContentsTheSame</span><span class="params">(<span class="keyword">int</span> oldItemPosition, <span class="keyword">int</span> newItemPosition)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mOldItemList.get(oldItemPosition).areContentsTheSame(mNewItemList.get(newItemPosition));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="EventsFragment-java-2"><a href="#EventsFragment-java-2" class="headerlink" title="EventsFragment.java"></a>EventsFragment.java</h2><ul>
<li><p>因為Adapter已經更改了，所以下一步改寫setRecyclerView</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//設定RecyclerView的Adapter</span></span><br><span class="line"><span class="meta">@SuppressLint</span>(<span class="string">"WrongConstant"</span>)</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setRecyclerView</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Log.i(<span class="string">"EventsFragment"</span>, <span class="string">"setRecyclerView"</span>);</span><br><span class="line">	ArrayList&lt;EventsInfo&gt; infoList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">	mBinding.eventsRecyclerviewEventsList.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(getActivity()));</span><br><span class="line">	mRecyclerAdapter = <span class="keyword">new</span> EventsAdapter(infoList, R.layout.layout_events_recyclerview, mItemClickListener);</span><br><span class="line">	mBinding.eventsRecyclerviewEventsList.setAdapter(mRecyclerAdapter);</span><br><span class="line">	</span><br><span class="line">       mBinding.eventsPgb.setVisibility(View.GONE);</span><br><span class="line">       mBinding.eventsLayswipeUpdateUpdate.setVisibility(View.VISIBLE);</span><br><span class="line">       mBinding.eventsRecyclerviewEventsList.setVisibility(View.VISIBLE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//分割線</span></span><br><span class="line">	DividerItemDecoration mDivider = <span class="keyword">new</span> DividerItemDecoration(getActivity(), DividerItemDecoration.VERTICAL);</span><br><span class="line">	mDivider.setDrawable(getResources().getDrawable(R.drawable.system_list_divider));</span><br><span class="line">	<span class="keyword">if</span>( mBinding.eventsRecyclerviewEventsList.getItemDecorationCount() == <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		mBinding.eventsRecyclerviewEventsList.addItemDecoration(mDivider);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="RecyclerView分割線"><a href="#RecyclerView分割線" class="headerlink" title="RecyclerView分割線"></a>RecyclerView分割線</h2><ul>
<li><p>因為每更新一次資料，RecyclreView的item之間間隔會越來越大，為了解決這個問題，所以要先判斷分割線是否已經被新增過(是否為0)，這樣才不會重複新增</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//分割線</span></span><br><span class="line">DividerItemDecoration mDivider = <span class="keyword">new</span> DividerItemDecoration(getActivity(), DividerItemDecoration.VERTICAL);</span><br><span class="line">mDivider.setDrawable(getResources().getDrawable(R.drawable.system_list_divider));</span><br><span class="line"><span class="keyword">if</span>( mBinding.eventsRecyclerviewEventsList.getItemDecorationCount() == <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">	mBinding.eventsRecyclerviewEventsList.addItemDecoration(mDivider);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>#改寫EventsFragment.java的按鈕邏輯</p>
<ul>
<li>原先傳入值為url要改寫為position</li>
<li>將抓取圖片顯示事件寫到EventsViewModel.java</li>
</ul>
<h2 id="EventsViewModel-java-1"><a href="#EventsViewModel-java-1" class="headerlink" title="EventsViewModel.java"></a>EventsViewModel.java</h2><ul>
<li>宣告</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//點擊儲存字串</span></span><br><span class="line"><span class="keyword">private</span> List&lt;EventsInfo&gt; mEventsClickList;</span><br><span class="line"></span><br><span class="line"><span class="comment">//EventsDetail頁面圖片</span></span><br><span class="line"><span class="keyword">public</span> MutableLiveData&lt;String&gt; mEventDetailImg = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//儲存點擊位置</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mPosition;</span><br></pre></td></tr></table></figure>

<ul>
<li>設定將點擊位置傳入的方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//設定click的位置</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setClickPosition</span><span class="params">(<span class="keyword">int</span> position)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.mPosition = position;</span><br><span class="line">	Log.i(<span class="string">"EventsViewmodel"</span>, <span class="string">"position:"</span> + position);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>利用傳入的位子，抓取position對應的url</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//利用Click位置抓取資料</span></span><br><span class="line"><span class="function">String <span class="title">getEventsClickImage</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Log.i(<span class="string">"EventsViewModel"</span>, <span class="string">"getEventsClickImage :"</span> + mEventsClickList.get(mPosition).url);</span><br><span class="line">	<span class="keyword">return</span> mEventsClickList.get(mPosition).url;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="EventsFragment-java-3"><a href="#EventsFragment-java-3" class="headerlink" title="EventsFragment.java"></a>EventsFragment.java</h2><ul>
<li><p>改寫按鈕事件內容，使點擊設定Bundle為url</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//按鈕事件</span></span><br><span class="line"><span class="keyword">private</span> EventsAdapter.OnClickListener mItemClickListener = <span class="keyword">new</span> EventsAdapter.OnClickListener()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(<span class="keyword">int</span> position)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//將位置訊息傳入</span></span><br><span class="line">		mViewModel.setClickPosition(position);</span><br><span class="line">		<span class="comment">//設定bundle</span></span><br><span class="line">		Bundle args = <span class="keyword">new</span> Bundle();</span><br><span class="line">		args.putString(ApiDetail.ItemName.ITEM_URL, mViewModel.getEventsClickImage());</span><br><span class="line"></span><br><span class="line">		FragmentTransaction transaction = (getActivity()).getSupportFragmentManager().beginTransaction();</span><br><span class="line">		String fragmentTag = EventsDetailFragment<span class="class">.<span class="keyword">class</span>.<span class="title">getSimpleName</span>()</span>;</span><br><span class="line">		Fragment newFragment = <span class="keyword">new</span> EventsDetailFragment();</span><br><span class="line"></span><br><span class="line">		newFragment.setArguments(args);</span><br><span class="line">		<span class="comment">//在此將原先的tabcontent改成新增的root_frame</span></span><br><span class="line">		transaction.add(R.id.fragment_events_root_frame, newFragment, fragmentTag);</span><br><span class="line">		<span class="comment">//隱藏此頁面</span></span><br><span class="line">		transaction.hide(mEventsFragment);</span><br><span class="line">		<span class="comment">//強迫新Fragment執行STARTED生命週期</span></span><br><span class="line">		transaction.setMaxLifecycle(newFragment, Lifecycle.State.STARTED);</span><br><span class="line"></span><br><span class="line">		transaction.addToBackStack(fragmentTag);</span><br><span class="line">		transaction.commit();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="使用Glis直接下載圖片"><a href="#使用Glis直接下載圖片" class="headerlink" title="使用Glis直接下載圖片"></a>使用Glis直接下載圖片</h1><ul>
<li><p>新增layout的Image設定方法</p>
</li>
<li><p>原先使用ImageHelper需要載入時，使用方法</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageHelper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ImageHelper mInstance;</span><br><span class="line">	<span class="keyword">private</span> ImageLoader mImageLoader;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">ImageHelper</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//建立image的Request 建構式 只會建一次</span></span><br><span class="line">		RequestQueue mRequestQueue;</span><br><span class="line">		mRequestQueue = VolleyHelper.getInstance().getRequestQueue();</span><br><span class="line">		mImageLoader = <span class="keyword">new</span> ImageLoader(mRequestQueue, <span class="keyword">new</span> BitmapCache());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createInstance</span><span class="params">(Context context)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(mInstance == <span class="keyword">null</span>)&#123;</span><br><span class="line">			mInstance = <span class="keyword">new</span> ImageHelper();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//呼叫即建立一個新的ImageHelper</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ImageHelper <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mInstance;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//發生的事件</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadingImage</span><span class="params">(String iconUrl, ImageLoader.ImageListener imageListener)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		mImageLoader.get(iconUrl,imageListener);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="gradle-app"><a href="#gradle-app" class="headerlink" title="gradle(app)"></a>gradle(app)</h2><ul>
<li><p>為了使用功能，使傳入url可以直接下載圖片</p>
</li>
<li><p>在gradle.app裡下載</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.github.bumptech.glide:glide:4.8.0'</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="ImageHelper-java"><a href="#ImageHelper-java" class="headerlink" title="ImageHelper.java"></a>ImageHelper.java</h2><ul>
<li><p>在ImageHelper.java裡新增方法</p>
</li>
<li><p>之後即可在layout裡用app:imageUrl設定</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@BindingAdapter</span>(&#123; <span class="string">"imageUrl"</span>&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadImage</span><span class="params">(ImageView iv, String url)</span></span>&#123;</span><br><span class="line">	Glide.with(iv.getContext()).load(url).into(iv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="RecyclerView的layout資料設定"><a href="#RecyclerView的layout資料設定" class="headerlink" title="RecyclerView的layout資料設定"></a>RecyclerView的layout資料設定</h1><h2 id="layout-events-recyclerview-xml-1"><a href="#layout-events-recyclerview-xml-1" class="headerlink" title="layout_events_recyclerview.xml"></a>layout_events_recyclerview.xml</h2><ul>
<li>使用Binding剛加入的item資料</li>
<li>因為引入的是EventsInfo，所以可以直接做資料設定</li>
<li>變數名稱要打對，否則會Binding錯誤</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"item"</span> <span class="attr">type</span>=<span class="string">"com.example.mvvmtest2.EventsInfo"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:background</span>=<span class="string">"@color/translucent"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">tools:background</span>=<span class="string">"@drawable/system_background_blur"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">tools:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">	&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">			<span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">android:background</span>=<span class="string">"@drawable/system_list_btn"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">android:paddingBottom</span>=<span class="string">"20dp"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">android:paddingTop</span>=<span class="string">"20dp"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">android:baselineAligned</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">			<span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">				<span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">android:layout_weight</span>=<span class="string">"2"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">			&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--在此有變更 直接傳入url請求網路圖片--&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:id</span>=<span class="string">"@+id/events_rcv_iv_icon_url"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">app:imageUrl</span>=<span class="string">"@&#123;item.iconUrl&#125;"</span></span></span><br><span class="line"><span class="tag">				/&gt;</span></span><br><span class="line"></span><br><span class="line">			<span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">				<span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">android:layout_weight</span>=<span class="string">"5"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">			&gt;</span></span><br><span class="line">			    <span class="comment">&lt;!--在此有變更 直接抓取item裡面資料--&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:id</span>=<span class="string">"@+id/events_rcv_tv_title"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:textSize</span>=<span class="string">"@dimen/special_price"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:textColor</span>=<span class="string">"@color/events_title"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:textStyle</span>=<span class="string">"bold"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:paddingBottom</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">tools:text</span>=<span class="string">"EXTRA BOUNS !"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:text</span>=<span class="string">"@&#123;item.title&#125;"</span></span></span><br><span class="line"><span class="tag">				/&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">				&gt;</span></span><br><span class="line">				    <span class="comment">&lt;!--在此有變更 直接抓取item裡面資料--&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:id</span>=<span class="string">"@+id/events_rcv_tv_begin_date"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:textSize</span>=<span class="string">"@dimen/textsize"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:textColor</span>=<span class="string">"@color/events_date"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">tools:text</span>=<span class="string">"04/10/2015"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:text</span>=<span class="string">"@&#123;item.beginData&#125;"</span></span></span><br><span class="line"><span class="tag">					/&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:textSize</span>=<span class="string">"20sp"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:textColor</span>=<span class="string">"@color/events_date"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:text</span>=<span class="string">"@string/date"</span></span></span><br><span class="line"><span class="tag">					/&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:id</span>=<span class="string">"@+id/events_rcv_tv_end_date"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:textSize</span>=<span class="string">"@dimen/textsize"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:textColor</span>=<span class="string">"@color/events_date"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">tools:text</span>=<span class="string">"04/12/2015"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">android:text</span>=<span class="string">"@&#123;item.endData&#125;"</span></span></span><br><span class="line"><span class="tag">					/&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">			<span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">				<span class="attr">android:layout_width</span>=<span class="string">"30dp"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">			&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">android:src</span>=<span class="string">"@drawable/system_icon_nextpage"</span></span></span><br><span class="line"><span class="tag">				/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="啟動Adapter的更新機制"><a href="#啟動Adapter的更新機制" class="headerlink" title="啟動Adapter的更新機制"></a>啟動Adapter的更新機制</h1><h2 id="EventsViewModel-java-2"><a href="#EventsViewModel-java-2" class="headerlink" title="EventsViewModel.java"></a>EventsViewModel.java</h2><ul>
<li><p>將原先儲存的List改為MutableLiveData，使List內容變動時，可以被監聽</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//List</span></span><br><span class="line">MutableLiveData&lt;List&lt;EventsApi.ListEvents&gt;&gt; mEventsList = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br></pre></td></tr></table></figure>
</li>
<li><p>因為改為MutableLiveData 資料儲存要改為postValue</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//抓取EventsList Request</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getEventsList</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	mModel.sendMsgResponse(<span class="keyword">new</span> EventsModel.itemEvents()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(List&lt;EventsInfo&gt; data)</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="comment">//資料抓取成功</span></span><br><span class="line">			mIsEventsDataGet.postValue(<span class="keyword">true</span>);</span><br><span class="line">			<span class="comment">//將資料放入List</span></span><br><span class="line">			mEventsList.postValue(data);</span><br><span class="line"></span><br><span class="line">			mEventsClickList = data;</span><br><span class="line">			Log.i(<span class="string">"EventsViewModel"</span>, <span class="string">"getEventsList:onSuccess"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(String errorResulte)</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="comment">//資料抓取失敗</span></span><br><span class="line">			mIsEventsDataGet.postValue(<span class="keyword">false</span>);</span><br><span class="line">			Log.i(<span class="string">"EventsViewModel"</span>, <span class="string">"getEventsList:onError"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="EventsFragment-java-4"><a href="#EventsFragment-java-4" class="headerlink" title="EventsFragment.java"></a>EventsFragment.java</h2><ul>
<li><p>因為將資料直接post到List上了，所以不需要額外儲存，更新時也會自動更新上去</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">      mViewModel.getEventsList();</span><br><span class="line">mViewModel.mIsEventsDataGet.observe(<span class="keyword">this</span>, <span class="keyword">new</span> Observer&lt;Boolean&gt;()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">(Boolean aBoolean)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( aBoolean )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//mData = mViewModel.mEventsList;</span></span><br><span class="line">			setRecyclerView();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>將Adapter宣告 改為剛改好的Adapter</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//設定RecyclerView Adapter</span></span><br><span class="line"><span class="comment">//private RecyclerView.Adapter mRecyclerAdapter</span></span><br><span class="line"><span class="keyword">private</span> EventsAdapter mRecyclerAdapter;</span><br></pre></td></tr></table></figure>
</li>
<li><p>將EventsApi.ListEvents都換成EventsInfo</p>
</li>
<li><p>當List資料變動會呼叫</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mViewModel.mEventsList.observe(<span class="keyword">this</span>, <span class="keyword">new</span> Observer&lt;List&lt;EventsInfo&gt;&gt;()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">(List&lt;EventsInfo&gt; listEvents)</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="keyword">try</span></span><br><span class="line">			&#123;</span><br><span class="line">				Log.i(<span class="string">"EventsFragment"</span>, <span class="string">"eventsList:observe"</span>);</span><br><span class="line">				mRecyclerAdapter.refresh(listEvents);</span><br><span class="line">				mRecyclerAdapter.notifyDataSetChanged();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span>( Exception e )</span><br><span class="line">			&#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="View元件顯示"><a href="#View元件顯示" class="headerlink" title="View元件顯示"></a>View元件顯示</h1><h2 id="EventsFragment-java-5"><a href="#EventsFragment-java-5" class="headerlink" title="EventsFragment.java"></a>EventsFragment.java</h2><ul>
<li><p>將Binding設定的顯示元件 改寫到ViewModel</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//設定RecyclerView的Adapter</span></span><br><span class="line"><span class="meta">@SuppressLint</span>(<span class="string">"WrongConstant"</span>)</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setRecyclerView</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Log.i(<span class="string">"EventsFragment"</span>, <span class="string">"setRecyclerView"</span>);</span><br><span class="line">	ArrayList&lt;EventsInfo&gt; infoList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">	mBinding.eventsRecyclerviewEventsList.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(getActivity()));</span><br><span class="line">	mRecyclerAdapter = <span class="keyword">new</span> EventsAdapter(infoList, R.layout.layout_events_recyclerview, mItemClickListener);</span><br><span class="line">	mBinding.eventsRecyclerviewEventsList.setAdapter(mRecyclerAdapter);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//mBinding.eventsPgb.setVisibility(View.GONE);</span></span><br><span class="line">       <span class="comment">//mBinding.eventsLayswipeUpdateUpdate.setVisibility(View.VISIBLE);</span></span><br><span class="line">       <span class="comment">//mBinding.eventsRecyclerviewEventsList.setVisibility(View.VISIBLE);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//分割線</span></span><br><span class="line">	DividerItemDecoration mDivider = <span class="keyword">new</span> DividerItemDecoration(getActivity(), DividerItemDecoration.VERTICAL);</span><br><span class="line">	mDivider.setDrawable(getResources().getDrawable(R.drawable.system_list_divider));</span><br><span class="line">	<span class="keyword">if</span>( mBinding.eventsRecyclerviewEventsList.getItemDecorationCount() == <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		mBinding.eventsRecyclerviewEventsList.addItemDecoration(mDivider);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="EventsViewModel-java-3"><a href="#EventsViewModel-java-3" class="headerlink" title="EventsViewModel.java"></a>EventsViewModel.java</h2><ul>
<li><p>宣告控制ProgressBar、SwipeRefreshLayout、RecyclerView的顯示Boolean</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> MutableData&lt;Boolean&gt; mIsShowEventsPgb = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line"><span class="keyword">public</span> MutableData&lt;Boolean&gt; mIsShowEventsLayswipe = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line"><span class="keyword">public</span> MutableData&lt;Boolean&gt; mIsShowEventsRcv = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br></pre></td></tr></table></figure>
</li>
<li><p>當顯示元件狀態需要更改</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showRcv</span><span class="params">()</span></span>&#123;</span><br><span class="line">    mIsShowEventsLayswipe.postValue(<span class="keyword">true</span>);</span><br><span class="line">    mIsShowEventsPgb.postValue(<span class="keyword">false</span>);</span><br><span class="line">    mIsShowEventsRcv.postValue(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="EventsFragment-java-6"><a href="#EventsFragment-java-6" class="headerlink" title="EventsFragment.java"></a>EventsFragment.java</h2><ul>
<li><p>直接使用EventsViewModel.java的方法</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//設定RecyclerView的Adapter</span></span><br><span class="line">	<span class="meta">@SuppressLint</span>(<span class="string">"WrongConstant"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setRecyclerView</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Log.i(<span class="string">"EventsFragment"</span>, <span class="string">"setRecyclerView"</span>);</span><br><span class="line">		ArrayList&lt;EventsInfo&gt; infoList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		mBinding.eventsRecyclerviewEventsList.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(getActivity()));</span><br><span class="line">		mRecyclerAdapter = <span class="keyword">new</span> EventsAdapter(infoList, R.layout.layout_events_recyclerview, mItemClickListener);</span><br><span class="line">		mBinding.eventsRecyclerviewEventsList.setAdapter(mRecyclerAdapter);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//mBinding.eventsPgb.setVisibility(View.GONE);</span></span><br><span class="line">        <span class="comment">//mBinding.eventsLayswipeUpdateUpdate.setVisibility(View.VISIBLE);</span></span><br><span class="line">        <span class="comment">//mBinding.eventsRecyclerviewEventsList.setVisibility(View.VISIBLE);</span></span><br><span class="line">        </span><br><span class="line">        mViewModel.showRcv();</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">## fragment_events.xml</span><br><span class="line"></span><br><span class="line">- 因為顯示是使用Boolean控制GONE/VISIBLE，所以要引入</span><br><span class="line"></span><br><span class="line">	```HTML=</span><br><span class="line">&lt;layout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span> xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span>&gt;</span><br><span class="line">	&lt;data&gt;</span><br><span class="line">	    &lt;!--引入此方法 即可控制View顯示--&gt;</span><br><span class="line">		&lt;<span class="keyword">import</span> type=<span class="string">"android.view.View"</span>/&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;variable name=<span class="string">"viewModel"</span> type=<span class="string">"com.example.mvvmtest2.EventsViewModel"</span> /&gt;</span><br><span class="line">	&lt;/data&gt;</span><br><span class="line">	...</span><br><span class="line">&lt;/layout&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用方式</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">ProgressBar</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:id</span>=<span class="string">"@+id/events_pgb"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyle"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:layout_width</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:paddingTop</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:visibility</span>=<span class="string">"@&#123;viewModel.mIsShowEventsPgb ? View.VISIBLE : View.GONE&#125;"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.swiperefreshlayout.widget.SwipeRefreshLayout</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:id</span>=<span class="string">"@+id/events_layswipe_update_update"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:visibility</span>=<span class="string">"@&#123;viewModel.mIsShowEventsLayswipe ? View.VISIBLE : View.GONE&#125;"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">androidx.recyclerview.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:id</span>=<span class="string">"@+id/events_recyclerview_events_list"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:clipToPadding</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:scrollbars</span>=<span class="string">"none"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:visibility</span>=<span class="string">"@&#123;viewModel.mIsShowEventsRcv ? View.VISIBLE : View.GONE&#125;"</span></span></span><br><span class="line"><span class="tag">	/&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="重構EventsDetailFragment-xml"><a href="#重構EventsDetailFragment-xml" class="headerlink" title="重構EventsDetailFragment.xml"></a>重構EventsDetailFragment.xml</h1><h2 id="fragment-events-detail-xml"><a href="#fragment-events-detail-xml" class="headerlink" title="fragment_events_detail.xml"></a>fragment_events_detail.xml</h2><ul>
<li>DataBinding EventsViewModel</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"viewmodel"</span> <span class="attr">type</span>=<span class="string">"com.example.mvvmtest2.EventsViewModel"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="EventsViewModel-java-4"><a href="#EventsViewModel-java-4" class="headerlink" title="EventsViewModel.java"></a>EventsViewModel.java</h1><ul>
<li>在EventsViewModel.java裡宣告</li>
<li>使資料做綁定後，可以直接更改資料</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//EventsDetail頁面圖片</span></span><br><span class="line"><span class="keyword">public</span> MutableLiveData&lt;String&gt; mEventsDetailImg = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br></pre></td></tr></table></figure>

<ul>
<li>將抓到的bundle傳入，設定給mEventDetailImg</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//將輸入的url 傳入img</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setEventsClickImage</span><span class="params">(Bundle bundle)</span></span>&#123;</span><br><span class="line">    String url = bundle.getString(ApiDetail.Item.ITEM_URL);</span><br><span class="line">    mEventDetailImg.postValue(url);</span><br><span class="line">    Log.i(<span class="string">"EventsViewModel"</span>,<span class="string">"setClickEventsImage :"</span> + url);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## fragment_events_detail.xml</span><br><span class="line"></span><br><span class="line">- 更改ImageView</span><br><span class="line"></span><br><span class="line">```xml=</span><br><span class="line">&lt;ImageView</span><br><span class="line">    android:id=<span class="string">"@+id/events_detail_iv_pic"</span></span><br><span class="line">    android:layout_width=<span class="string">"fill_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">    android:scaleType=<span class="string">"fitXY"</span></span><br><span class="line">    app:imageUrl=<span class="string">"@&#123;viewmodel.mEventDetailImg&#125;"</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<h2 id="EventsViewModel-java-5"><a href="#EventsViewModel-java-5" class="headerlink" title="EventsViewModel.java"></a>EventsViewModel.java</h2><ul>
<li><p>宣告額外儲存點擊的List</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//點擊儲存字串</span></span><br><span class="line"><span class="keyword">private</span> List&lt;EventsInfo&gt; mEventList;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在getEventsList()裡將data存入List</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//抓取EventsList Request</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getEventsList</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	mModel.sendMsgResponse(<span class="keyword">new</span> EventsModel.itemEvents()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(List&lt;EventsInfo&gt; data)</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="comment">//資料抓取成功</span></span><br><span class="line">			mIsEventsDataGet.postValue(<span class="keyword">true</span>);</span><br><span class="line">			<span class="comment">//將資料放入List</span></span><br><span class="line">			mEventsList.postValue(data);</span><br><span class="line"></span><br><span class="line">			mEventsClickList = data;</span><br><span class="line">			Log.i(<span class="string">"EventsViewModel"</span>, <span class="string">"getEventsList:onSuccess"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(String errorResulte)</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="comment">//資料抓取失敗</span></span><br><span class="line">			mIsEventsDataGet.postValue(<span class="keyword">false</span>);</span><br><span class="line">			Log.i(<span class="string">"EventsViewModel"</span>, <span class="string">"getEventsList:onError"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="EventsDetailFragment-java"><a href="#EventsDetailFragment-java" class="headerlink" title="EventsDetailFragment.java"></a>EventsDetailFragment.java</h2><ul>
<li><p>重構EventsDetailFragment.java</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventsDetailFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">		@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	FragmentEventsDetailBinding mBinding = DataBindingUtil.inflate(inflater,R.layout.fragment_events_detail,container,</span><br><span class="line">	                                                               <span class="keyword">false</span>);</span><br><span class="line">	View v = mBinding.getRoot();</span><br><span class="line">	EventsViewModel mViewModel = <span class="keyword">new</span> EventsViewModel();</span><br><span class="line">	mBinding.setViewmodel(mViewModel);</span><br><span class="line">	mBinding.setLifecycleOwner(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//抓取bundle資料</span></span><br><span class="line">	Bundle bundle = getArguments();</span><br><span class="line">	mViewModel.setEventsClickImage(bundle);</span><br><span class="line">	mBinding.eventsDetailIvPic.setClickable(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://baiibbai.github.io/2020/05/27/MVVM%E6%9E%B6%E6%A7%8B%E7%AF%84%E4%BE%8B/" data-id="ckap56ggx000214gz8gj5cfzi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/05/27/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hello World
        
      </div>
    </a>
  
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">彙整</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/05/27/Java-%E9%A1%9E%E5%88%A5/">Java-類別</a>
          </li>
        
          <li>
            <a href="/2020/05/27/TextInputLayout/">TextInputLayout</a>
          </li>
        
          <li>
            <a href="/2020/05/27/Java%E7%AD%86%E8%A8%98/">Java筆記</a>
          </li>
        
          <li>
            <a href="/2020/05/27/NetLinking%E6%9E%B6%E8%A8%AD%E7%B6%B2%E7%AB%99/">NetLinking架設網站</a>
          </li>
        
          <li>
            <a href="/2020/05/27/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>